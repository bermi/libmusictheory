<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>libmusictheory Harmonious Compatibility Validation</title>
  <link rel="stylesheet" href="./styles.css" />
  <style>
    .controls {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 0.75rem;
      margin-bottom: 0.75rem;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      background: #fff;
    }
    th, td {
      border: 1px solid var(--line);
      padding: 0.45rem 0.55rem;
      font-size: 0.83rem;
      text-align: left;
      vertical-align: top;
    }
    th {
      background: #f3efe3;
      color: #3f3a2b;
    }
    .good {
      color: #1f6c72;
      font-weight: 600;
    }
    .bad {
      color: #9e3b22;
      font-weight: 600;
    }
    .mono {
      font-family: "IBM Plex Mono", "SFMono-Regular", monospace;
    }
    .preview-grid {
      display: grid;
      gap: 0.75rem;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    }
    .preview-grid article {
      border: 1px solid var(--line);
      border-radius: 0.4rem;
      padding: 0.6rem;
      background: #fff;
    }
    .preview-grid .svg-host {
      min-height: 120px;
      margin-top: 0.4rem;
    }
    .small {
      color: var(--muted);
      font-size: 0.8rem;
    }
    .sample-kind {
      border: 1px solid var(--line);
      border-radius: 0.4rem;
      background: #fff;
      padding: 0.75rem;
      margin-top: 0.75rem;
    }
    .sample-kind h3 {
      margin: 0 0 0.5rem;
      color: #3f3a2b;
      font-size: 0.95rem;
    }
    .sample-items {
      display: grid;
      gap: 0.75rem;
      grid-template-columns: repeat(auto-fit, minmax(460px, 1fr));
    }
    .sample-item {
      border: 1px solid var(--line);
      border-radius: 0.35rem;
      padding: 0.55rem;
      background: #fcfbf8;
    }
    .sample-item .sample-meta {
      margin: 0 0 0.4rem;
      font-size: 0.8rem;
      color: var(--muted);
    }
    .sample-compare {
      display: grid;
      gap: 0.55rem;
      grid-template-columns: repeat(2, minmax(0, 1fr));
    }
    .sample-compare h4 {
      margin: 0 0 0.3rem;
      font-size: 0.83rem;
      color: #3f3a2b;
    }
    .sample-compare .svg-host {
      min-height: 110px;
    }
    .sample-empty {
      color: var(--muted);
      font-size: 0.83rem;
      margin-top: 0.4rem;
    }
  </style>
</head>
<body>
  <header>
    <h1>Harmoniousapp.net SVG Compatibility Validation</h1>
    <p>All SVGs are generated by WASM compatibility APIs and optionally compared against local reference files.</p>
    <p id="status">Loading WASM module...</p>
  </header>

  <main>
    <section>
      <h2>Run Validation</h2>
      <div class="controls">
        <label>Reference root URL
          <input id="ref-root" value="/tmp/harmoniousapp.net" />
        </label>
        <label>Compare with reference files
          <select id="compare-enabled">
            <option value="1">Enabled</option>
            <option value="0">Disabled</option>
          </select>
        </label>
        <label>Random visual compare
          <select id="visual-sample-enabled">
            <option value="1">Enabled</option>
            <option value="0">Disabled</option>
          </select>
        </label>
        <label>Visual samples per kind (min 5)
          <input id="visual-sample-size" type="number" min="5" step="1" value="5" />
        </label>
      </div>
      <button id="run-validation">Generate and Validate All Kinds</button>
      <pre id="progress"></pre>
    </section>

    <section>
      <h2>Per-Kind Summary</h2>
      <div id="summary-host"></div>
    </section>

    <section>
      <h2>First Mismatch Preview</h2>
      <p class="small">Shows the first generated SVG that does not byte-match the fetched reference.</p>
      <div id="mismatch-meta" class="mono"></div>
      <div class="preview-grid">
        <article>
          <h3>Generated</h3>
          <div id="generated-host" class="svg-host"></div>
        </article>
        <article>
          <h3>Reference</h3>
          <div id="reference-host" class="svg-host"></div>
        </article>
      </div>
    </section>

    <section>
      <h2>Random Visual Compare (Per Kind)</h2>
      <p class="small">Shows random side-by-side generated/reference SVG pairs from the current verification run.</p>
      <div id="visual-samples-host" class="small">No visual samples yet. Run validation to populate this section.</div>
    </section>
  </main>

  <script type="module" src="./validation.js"></script>
</body>
</html>
