# Orbifold Voice-Leading Graph

> References: [Evenness, Voice Leading and Geometry](../evenness-voice-leading-and-geometry.md)
> Source: `tmp/harmoniousapp.net/svg/triads-graphviz-maj-min-orbifold.svg`
> Source: `tmp/harmoniousapp.net/p/78/Orbifold-Voice-Leading.html`

## Overview

The orbifold graph shows chords as nodes in a geometric space where distance equals voice-leading distance. For triads (cardinality 3), this forms a 3D structure of four cubes meeting at diagonal corners, with augmented triads at the center.

## SVG Specifications

- **Source**: Generated by Graphviz, then styled
- **Layout**: Force-directed or geometric layout
- **Nodes**: Circles representing chords, labeled with chord names
- **Edges**: Gray lines connecting chords that differ by a single semitone of voice leading
- **Node positioning**: More even chords near center, less even near edges

## Geometric Structure (Triads, C=3)

```
Center:     4 augmented triads (perfectly even, 4 transpositions)
Inner ring: 12 major triads + 12 minor triads (nearly even)
Outer ring: 12 diminished triads (less even)
Edge:       Degenerate triads (doubled notes) at the boundary
```

The 3D orbifold has:
- 4 cubes touching at diagonal corners
- A central axis of perfect evenness (augmented triads)
- 120° twist between first and last repeat (Möbius-like)
- Major/minor triads at equal radius from center

## Generation Algorithm

### Step 1: Enumerate All Triads

```
triads = []
for root in 0..11:
    triads.append(major_triad(root))
    triads.append(minor_triad(root))
    triads.append(dim_triad(root))
    triads.append(aug_triad(root))  // only 4 unique
// Deduplicate augmented triads
// Total: 12 major + 12 minor + 12 dim + 4 aug = 40 unique triads
```

### Step 2: Compute Voice-Leading Edges

```
edges = []
for i in 0..len(triads):
    for j in i+1..len(triads):
        vl_dist = vl_distance(triads[i], triads[j])
        if vl_dist == 1:
            edges.append((i, j, vl_dist))
```

### Step 3: Layout (Orbifold Coordinates)

```
orbifold_position(chord):
    radius = evenness_distance(chord)
    root = chord_root(chord)
    quality = chord_quality(chord)

    // Angular position based on root (circle of fifths or chromatic)
    angle = root * (2 * PI / 12)

    // Height based on quality
    z = switch quality:
        MAJOR: 0.5
        MINOR: -0.5
        AUGMENTED: 0.0   // center
        DIMINISHED: 1.0  // outer

    return (radius * cos(angle), radius * sin(angle), z)
```

### Step 4: 3D to 2D Projection

```
project_to_2d(x, y, z, view_angle):
    // Simple orthographic or perspective projection
    px = x * cos(view_angle) + z * sin(view_angle)
    py = y
    return (px, py)
```

### Step 5: SVG Generation

```xml
<svg xmlns="http://www.w3.org/2000/svg" viewBox="...">
  <!-- Edges (gray lines) -->
  <line x1="{x1}" y1="{y1}" x2="{x2}" y2="{y2}"
        stroke="#ccc" stroke-width="1"/>

  <!-- Nodes (circles with labels) -->
  <circle cx="{cx}" cy="{cy}" r="8" fill="{color}" stroke="black"/>
  <text x="{cx}" y="{cy+4}" text-anchor="middle" font-size="6">
    {chord_name}
  </text>
</svg>
```

## Higher Dimensions

For cardinality C > 3:
- C=4 (seventh chords): 4D orbifold with tesseracts
- C=2 (intervals): 2D Möbius strip
- C=1 (single notes): circle (pitch class circle)
- The library should compute orbifold coordinates for any cardinality

## Scatter Plot: Evenness vs Voice-Leading Distance

The site also includes a scatter plot (`tmp/harmoniousapp.net/svg/plot-evenness-v-vld.svg`) showing:
- X-axis: Evenness distance
- Y-axis: Average voice-leading distance to transpositions
- Points: One per set class, grouped by cardinality
- Regression lines per cardinality showing strong positive correlation

```
scatter_plot_data():
    points = []
    for sc in all_set_classes:
        ev = evenness_distance(sc)
        avg_vl = avg_vl_distance_to_transpositions(sc)
        card = cardinality(sc)
        points.append({x: ev, y: avg_vl, cardinality: card})
    return points
```

## Algorithm Dependencies
- [Voice Leading](../algorithms/voice-leading.md): VL distance, graph construction
- [Evenness and Consonance](../algorithms/evenness-and-consonance.md): orbifold radius
- [Chord Construction](../algorithms/chord-construction-and-naming.md): triad enumeration

## Interactivity (Future)
- 3D rotation of orbifold view
- Click node to hear chord and see details
- Highlight shortest voice-leading path between two chords
- Animate voice-leading transitions
- Filter by chord quality
